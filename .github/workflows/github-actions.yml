name: GitHub Actions Pipeline 🚀
run-name: ${{ github.actor }} is deploying rewe-app-be 🚀
on: [push]
jobs:
  Deploy-Rewe-App-Be:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Build image
        working-directory: ./
        run: |
          echo "Building rewe-app-be image... 🏗"
          echo "JWT_SECRET=$JWT_SECRET" >> .env
          docker build -t rewe-app-be-image .
      - name: Deploy image
        working-directory: ./rewe-app-be
        run: |
          echo "Deploying rewe-app-be image 🚀"
          docker stop rewe-app-be || true && docker rm rewe-app-be || true
          docker run -d --net rewe-net --ip 172.41.0.20  -v rewe-be-data:/app/data/ --name rewe-app-be rewe-app-be-image -p 8080:80
